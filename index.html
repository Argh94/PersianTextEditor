<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø± Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Fonts -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/font-face.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Sahel/Sahel.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Samim/Samim.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Shabnam/Shabnam.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Tanha/Tanha.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Titr/Titr.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Nazanin/Nazanin.css" rel="stylesheet">
  <link href="https://cdn.fontcdn.ir/Font/Persian/Nastaliq/Nastaliq.css" rel="stylesheet">
  <!-- Pickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      direction: rtl;
      background: #212529;
      color: #fff;
      margin: 0;
      min-height: 100vh;
    }
    .light-theme {
      background: linear-gradient(135deg, #e0e7ff, #f3f4f6);
      color: #333;
    }
    .light-theme #editor {
      background: #fff;
      border: 1px solid #ccc;
      color: #333;
    }
    .light-theme .form-select, .light-theme .btn {
      background-color: #e9ecef;
      color: #333;
      border-color: #ccc;
    }
    .light-theme .status-bar {
      color: #555;
    }
    .light-theme .preview {
      background: #f8f9fa;
      border-color: #4CAF50;
    }
    .light-theme .preview-header {
      color: #333;
    }
    #editor {
      min-height: 350px;
      background: #343a40;
      border: 1px solid #555;
      padding: 15px;
      border-radius: 8px;
      outline: none;
      color: #fff;
    }
    .preview {
      min-height: 200px;
      background: #fff;
      color: #333;
      border: 2px solid #4CAF50;
      border-radius: 8px;
      padding: 15px;
    }
    .preview img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }
    .preview-header {
      color: #fff;
      font-size: 1rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .toolbar button, .toolbar select {
      margin: 4px;
    }
    .form-select, .btn {
      background-color: #495057;
      color: #fff;
      border-color: #666;
    }
    .form-select option {
      background-color: #212529;
      color: #fff;
    }
    .btn:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }
    .status-bar {
      font-size: 0.9rem;
      margin-top: 10px;
      color: #ccc;
    }
    #alertContainer {
      position: fixed;
      top: 20px;
      right: 20px;
      left: 20px;
      z-index: 9999;
    }
    .alert {
      animation: slideIn 0.5s ease;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      padding: 10px;
    }
    .footer a {
      color: #fff;
      text-decoration: none;
    }
    .light-theme .footer a {
      color: #333;
    }
    .footer a:hover {
      color: #4CAF50;
    }
    .emoji-picker {
      position: absolute;
      background: #343a40;
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 200px;
    }
    .light-theme .emoji-picker {
      background: #e9ecef;
    }
    .emoji-picker span {
      cursor: pointer;
      font-size: 1.5rem;
    }
    .emoji-picker span:hover {
      transform: scale(1.2);
    }
  </style>
</head>
<body>
<div id="alertContainer" class="container"></div>
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø± Ù…ØªÙ† Ø¢Ù†Ù„Ø§ÛŒÙ†</h4>
    <button class="btn btn-sm btn-outline-light" onclick="toggleTheme()" aria-label="ØªØºÛŒÛŒØ± ØªÙ…">
      <i id="themeIcon" class="bi bi-moon"></i>
    </button>
  </div>
  <div class="toolbar d-flex flex-wrap mb-3">
    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="execCmd('bold')" aria-label="Ø¨ÙˆÙ„Ø¯"><i class="bi bi-type-bold"></i></button>
    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="execCmd('italic')" aria-label="Ø§ÛŒØªØ§Ù„ÛŒÚ©"><i class="bi bi-type-italic"></i></button>
    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="execCmd('underline')" aria-label="Ø²ÛŒØ±Ø®Ø·"><i class="bi bi-type-underline"></i></button>
    <button class="btn btn-outline-secondary btn-sm me-2 mb-2" onclick="execCmd('justifyRight')" aria-label="Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ†"><i class="bi bi-text-right"></i></button>
    <button class="btn btn-outline-secondary btn-sm me-2 mb-2" onclick="execCmd('justifyCenter')" aria-label="ÙˆØ³Ø·â€ŒÚ†ÛŒÙ†"><i class="bi bi-text-center"></i></button>
    <button class="btn btn-outline-secondary btn-sm me-2 mb-2" onclick="execCmd('justifyLeft')" aria-label="Ú†Ù¾â€ŒÚ†ÛŒÙ†"><i class="bi bi-text-left"></i></button>
    <button class="btn btn-outline-success btn-sm me-2 mb-2" onclick="execCmd('insertOrderedList')" aria-label="Ù„ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù‡â€ŒØ¯Ø§Ø±"><i class="bi bi-list-ol"></i></button>
    <button class="btn btn-outline-success btn-sm me-2 mb-2" onclick="execCmd('insertUnorderedList')" aria-label="Ù„ÛŒØ³Øª Ù†Ù‚Ø·Ù‡â€ŒØ¯Ø§Ø±"><i class="bi bi-list-ul"></i></button>
    <select class="form-select form-select-sm w-auto me-2 mb-2" onchange="execCmd('fontSize', this.value)" aria-label="Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª">
      <option value="">Ø§Ù†Ø¯Ø§Ø²Ù‡</option>
      <option value="1">8</option>
      <option value="2">10</option>
      <option value="3">12</option>
      <option value="4">14</option>
      <option value="5">16</option>
      <option value="6">20</option>
      <option value="7">24</option>
    </select>
    <select class="form-select form-select-sm w-auto me-2 mb-2" onchange="execCmd('fontName', this.value)" aria-label="ÙÙˆÙ†Øª">
      <option value="">ÙÙˆÙ†Øª</option>
      <option value="Vazir">ÙˆØ²ÛŒØ±</option>
      <option value="Sahel">Ø³Ø§Ø­Ù„</option>
      <option value="Samim">ØµÙ…ÛŒÙ…</option>
      <option value="Shabnam">Ø´Ø¨Ù†Ù…</option>
      <option value="Tanha">ØªÙ†Ù‡Ø§</option>
      <option value="B Titr">ØªÛŒØªØ±</option>
      <option value="B Nazanin">Ù†Ø§Ø²Ù†ÛŒÙ†</option>
      <option value="IranNastaliq">Ù†Ø³ØªØ¹Ù„ÛŒÙ‚</option>
    </select>
    <div id="fontColorPicker" class="ms-2 mb-2"></div>
    <div id="bgColorPicker" class="ms-2 mb-2"></div>
    <button class="btn btn-outline-warning btn-sm me-2 mb-2" onclick="execCmd('undo')" aria-label="Ø¨Ø§Ø²Ú¯Ø´Øª"><i class="bi bi-arrow-90deg-left"></i></button>
    <button class="btn btn-outline-warning btn-sm me-2 mb-2" onclick="execCmd('redo')" aria-label="Ø¬Ù„Ùˆ"><i class="bi bi-arrow-90deg-right"></i></button>
    <button class="btn btn-outline-light btn-sm me-2 mb-2" onclick="copyToClipboard()" aria-label="Ú©Ù¾ÛŒ"><i class="bi bi-clipboard"></i></button>
    <button class="btn btn-outline-danger btn-sm me-2 mb-2" onclick="clearEditor()" aria-label="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†"><i class="bi bi-trash"></i></button>
    <button class="btn btn-outline-info btn-sm me-2 mb-2" onclick="loadContent()" aria-label="Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ"><i class="bi bi-upload"></i></button>
    <button class="btn btn-outline-success btn-sm me-2 mb-2" onclick="promptSaveFormat()" aria-label="Ø°Ø®ÛŒØ±Ù‡"><i class="bi bi-download"></i></button>
    <button class="btn btn-outline-info btn-sm me-2 mb-2" onclick="showEmojiPicker()" aria-label="Ø´Ú©Ù„Ú©"><i class="bi bi-emoji-smile"></i></button>
    <button class="btn btn-outline-info btn-sm me-2 mb-2" onclick="document.getElementById('imageInput').click()" aria-label="ØªØµÙˆÛŒØ±"><i class="bi bi-image"></i></button>
    <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="insertImage()">
    <button class="btn btn-outline-light btn-sm me-2 mb-2" onclick="toggleFullscreen()" aria-label="ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡"><i class="bi bi-arrows-fullscreen"></i></button>
    <button class="btn btn-outline-warning btn-sm me-2 mb-2" onclick="checkSpelling()" aria-label="Ø§Ù…Ù„Ø§"><i class="bi bi-spellcheck"></i></button>
    <select class="form-select form-select-sm w-auto me-2 mb-2" onchange="insertTemplate(this.value)" aria-label="Ù‚Ø§Ù„Ø¨">
      <option value="">Ù‚Ø§Ù„Ø¨</option>
      <option value="letter">Ù†Ø§Ù…Ù‡ Ø±Ø³Ù…ÛŒ</option>
      <option value="resume">Ø±Ø²ÙˆÙ…Ù‡</option>
      <option value="poem">Ø´Ø¹Ø±</option>
      <option value="note">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±ÙˆØ²Ø§Ù†Ù‡</option>
      <option value="invitation">Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡</option>
      <option value="story">Ø¯Ø§Ø³ØªØ§Ù† Ú©ÙˆØªØ§Ù‡</option>
      <option value="blog">Ù¾Ø³Øª ÙˆØ¨Ù„Ø§Ú¯</option>
      <option value="plan">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</option>
    </select>
  </div>
  <div id="editor" contenteditable="true" aria-label="ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø± Ù…ØªÙ†"></div>
  <div class="input-group mt-3 mb-3">
    <span class="input-group-text"><i class="bi bi-file-earmark-arrow-up"></i></span>
    <input type="file" class="form-control" id="fileInput" accept=".txt" onchange="loadFromFile()" aria-label="Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„">
  </div>
  <div class="mt-3">
    <h5 class="preview-header"><i class="bi bi-eye"></i> Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</h5>
    <div class="preview p-3 text-dark border rounded" id="preview"></div>
  </div>
  <div class="status-bar mt-2" id="statusBar">Ú©Ù„Ù…Ø§Øª: 0 | Ú©Ø§Ø±Ø§Ú©ØªØ±: 0</div>
  <div class="footer">
    <a href="https://github.com/Argh94" target="_blank"><i class="bi bi-github"></i> Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†</a>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
<script>
  const editor = document.getElementById('editor');
  const preview = document.getElementById('preview');
  const statusBar = document.getElementById('statusBar');
  const alertContainer = document.getElementById('alertContainer');
  const themeIcon = document.getElementById('themeIcon');
  let currentBgColor = '#ffffff';

  function execCmd(cmd, val = null) {
    try {
      document.execCommand(cmd, false, val);
      editor.focus();
      updateStatus();
    } catch (e) {
      console.error(`Error in ${cmd}:`, e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§.', 'danger');
    }
  }

  function clearEditor() {
    editor.innerHTML = '';
    preview.innerHTML = '';
    currentBgColor = '#ffffff';
    preview.style.backgroundColor = currentBgColor;
    updateStatus();
    showAlert('Ù…Ø­ØªÙˆØ§ Ù¾Ø§Ú© Ø´Ø¯.', 'danger');
  }

  function copyToClipboard() {
    try {
      navigator.clipboard.writeText(editor.innerText);
      showAlert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯.', 'success');
    } catch (e) {
      console.error('Error in copy:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ.', 'danger');
    }
  }

  function loadContent() {
    const saved = localStorage.getItem("editorContent");
    if (saved) {
      editor.innerHTML = saved;
      preview.innerHTML = saved;
      updateStatus();
      showAlert('Ù…Ø­ØªÙˆØ§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.', 'info');
    } else {
      showAlert('Ù…Ø­ØªÙˆØ§ÛŒÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.', 'warning');
    }
  }

  function downloadText() {
    try {
      const blob = new Blob([editor.innerText], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "text.txt";
      link.click();
      showAlert('ÙØ§ÛŒÙ„ TXT Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯.', 'success');
    } catch (e) {
      console.error('Error in downloadText:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯.', 'danger');
    }
  }

  function saveAsPDF() {
    try {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.addFont('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/Vazir.ttf', 'Vazir', 'normal');
      doc.setFont('Vazir');
      doc.setFontSize(12);
      doc.text(editor.innerText, 10, 10, { align: 'right', maxWidth: 190 });
      doc.save('text.pdf');
      showAlert('ÙØ§ÛŒÙ„ PDF Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯.', 'success');
    } catch (e) {
      console.error('Error in saveAsPDF:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± PDF.', 'danger');
    }
  }

  function promptSaveFormat() {
    const format = prompt('Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡â€ŒØµÙˆØ±Øª PDF ÛŒØ§ TXTØŸ', 'TXT');
    if (format?.toLowerCase() === 'pdf') saveAsPDF();
    else if (format?.toLowerCase() === 'txt') downloadText();
    else showAlert('ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±.', 'warning');
  }

  function loadFromFile() {
    try {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        editor.innerText = e.target.result;
        preview.innerHTML = e.target.result;
        updateStatus();
        showAlert('ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯.', 'info');
      };
      reader.readAsText(file);
    } catch (e) {
      console.error('Error in loadFromFile:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ.', 'danger');
    }
  }

  function insertImage() {
    try {
      const fileInput = document.getElementById('imageInput');
      const file = fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.maxWidth = '100%';
        img.style.height = 'auto';
        editor.appendChild(img);
        updateStatus();
        showAlert('ØªØµÙˆÛŒØ± Ø¯Ø±Ø¬ Ø´Ø¯.', 'success');
      };
      reader.readAsDataURL(file);
    } catch (e) {
      console.error('Error in insertImage:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± ØªØµÙˆÛŒØ±.', 'danger');
    }
  }

  function updateStatus() {
    try {
      const text = editor.innerText.trim();
      const words = text ? text.split(/\s+/).length : 0;
      const chars = text.length;
      statusBar.textContent = `Ú©Ù„Ù…Ø§Øª: ${words} | Ú©Ø§Ø±Ø§Ú©ØªØ±: ${chars}`;
      preview.innerHTML = editor.innerHTML;
      preview.style.backgroundColor = currentBgColor;
    } catch (e) {
      console.error('Error in updateStatus:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª.', 'danger');
    }
  }

  function showAlert(message, type = 'info') {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type} alert-dismissible fade show mt-2`;
    alert.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
    alertContainer.appendChild(alert);
    setTimeout(() => alert.remove(), 4000);
  }

  function toggleTheme() {
    try {
      document.body.classList.toggle('light-theme');
      const isLight = document.body.classList.contains('light-theme');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      themeIcon.className = isLight ? 'bi bi-sun' : 'bi bi-moon';
      showAlert('ØªÙ… ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.', 'info');
    } catch (e) {
      console.error('Error in toggleTheme:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± ØªÙ….', 'danger');
    }
  }

  function showEmojiPicker() {
    try {
      const emojis = ['ğŸ˜Š', 'ğŸ‘', 'â¤ï¸', 'ğŸš€', 'ğŸŒŸ', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ˜', 'ğŸ±', 'ğŸ¶', 'ğŸ', 'ğŸ•', 'ğŸŒˆ', 'âš½', 'ğŸ®', 'ğŸ¸', 'âœ¨', 'ğŸ”¥', 'ğŸ’¡', 'ğŸ‰'];
      const emojiList = emojis.map(e => `<span onclick="insertEmoji('${e}')" style="cursor: pointer; font-size: 1.5rem; margin: 5px;">${e}</span>`).join('');
      if (document.querySelector('.emoji-picker')) document.querySelector('.emoji-picker').remove();
      editor.insertAdjacentHTML('beforeend', `<div class="emoji-picker">${emojiList}</div>`);
    } catch (e) {
      console.error('Error in showEmojiPicker:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø´Ú©Ù„Ú©â€ŒÙ‡Ø§.', 'danger');
    }
  }

  function insertEmoji(emoji) {
    try {
      document.querySelector('.emoji-picker').remove();
      document.execCommand('insertText', false, emoji);
      editor.focus();
      updateStatus();
    } catch (e) {
      console.error('Error in insertEmoji:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø¬ Ø´Ú©Ù„Ú©.', 'danger');
    }
  }

  function toggleFullscreen() {
    try {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        showAlert('ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡ ÙØ¹Ø§Ù„ Ø´Ø¯.', 'info');
      } else {
        document.exitFullscreen();
        showAlert('ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯.', 'info');
      }
    } catch (e) {
      console.error('Error in toggleFullscreen:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± ØªÙ…Ø§Ù…â€ŒØµÙØ­Ù‡.', 'danger');
    }
  }

  function checkSpelling() {
    try {
      const dict = { 'Ù…ÛŒ Ø´Ù‡': 'Ù…ÛŒØ´Ù‡', 'Ù†Ù…ÛŒØ¯ÙˆÙ†Ù…': 'Ù†Ù…ÛŒâ€ŒØ¯ÙˆÙ†Ù…', 'Ø®ÙˆØ¨Ø³Øª': 'Ø®ÙˆØ¨Ù‡', 'Ø¨Ø§Ø´': 'Ø¨Ø§Ø´Ù‡' };
      let text = editor.innerHTML;
      for (let wrong in dict) {
        text = text.replace(new RegExp(`\\b${wrong}\\b`, 'g'), `<span style="color: red; text-decoration: underline;">${dict[wrong]}</span>`);
      }
      editor.innerHTML = text;
      preview.innerHTML = text;
      showAlert('Ø§Ù…Ù„Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯.', 'info');
    } catch (e) {
      console.error('Error in checkSpelling:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ù…Ù„Ø§.', 'danger');
    }
  }

  function insertTemplate(template) {
    try {
      const templates = {
        letter: `<div style="font-family: Vazir; text-align: right;"><p style="font-size: 14px;">Ø¨Ø³Ù…Ù‡ ØªØ¹Ø§Ù„ÛŒ</p><p style="font-size: 14px;">Ø¬Ù†Ø§Ø¨ Ø¢Ù‚Ø§ÛŒ/Ø®Ø§Ù†Ù… ...<br>Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ</p><p style="font-size: 14px;">Ø¨Ø¯ÛŒÙ†â€ŒÙˆØ³ÛŒÙ„Ù‡ ...<br>Ø¨Ø§ ØªØ´Ú©Ø±ØŒ<br>Ø§Ù…Ø¶Ø§</p></div>`,
        resume: `<div style="font-family: Sahel; text-align: right;"><h3 style="text-align: center; color: #4CAF50;">Ø±Ø²ÙˆÙ…Ù‡</h3><p style="font-size: 14px;"><b>Ù†Ø§Ù…:</b> ...<br><b>ØªØ­ØµÛŒÙ„Ø§Øª:</b> ...<br><b>Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§:</b> ...<br><b>ØªØ¬Ø±Ø¨ÛŒØ§Øª Ú©Ø§Ø±ÛŒ:</b> ...</p></div>`,
        poem: `<div style="font-family: IranNastaliq; text-align: center;"><p style="font-size: 18px; line-height: 2;">Ø´Ø¹Ø±ÛŒ Ø²ÛŒØ¨Ø§<br>Ø¯Ø± Ø§ÛŒÙ†â€ŒØ¬Ø§ Ø´Ø¹Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ ÙÙˆÙ†Øª Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...</p></div>`,
        note: `<div style="font-family: Shabnam; text-align: right;"><p style="font-size: 14px;"><b>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø±ÙˆØ²Ø§Ù†Ù‡</b><br>ØªØ§Ø±ÛŒØ®: ...<br>Ø§Ù…Ø±ÙˆØ² ...<br>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ø¯Ø§: ...</p></div>`,
        invitation: `<div style="font-family: B Nazanin; text-align: center;"><h4 style="color: #D81B60;">Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡</h4><p style="font-size: 16px;">Ø¨Ø§ Ú©Ù…Ø§Ù„ Ø§ÙØªØ®Ø§Ø± Ø§Ø² Ø´Ù…Ø§ Ø¯Ø¹ÙˆØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø¯Ø± Ù…Ø±Ø§Ø³Ù… ... Ø´Ø±Ú©Øª Ú©Ù†ÛŒØ¯.<br>Ø²Ù…Ø§Ù†: ...<br>Ù…Ú©Ø§Ù†: ...</p></div>`,
        story: `<div style="font-family: Tanha; text-align: right;"><h4 style="color: #0288D1;">Ø¯Ø§Ø³ØªØ§Ù† Ú©ÙˆØªØ§Ù‡</h4><p style="font-size: 14px; line-height: 1.8;">Ø±ÙˆØ²ÛŒ Ø±ÙˆØ²Ú¯Ø§Ø±ÛŒØŒ Ø¯Ø± Ø³Ø±Ø²Ù…ÛŒÙ†ÛŒ Ø¯ÙˆØ± ...<br>Ø¯Ø§Ø³ØªØ§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.</p></div>`,
        blog: `<div style="font-family: Samim; text-align: right;"><h3 style="color: #388E3C;">Ø¹Ù†ÙˆØ§Ù† Ù¾Ø³Øª ÙˆØ¨Ù„Ø§Ú¯</h3><p style="font-size: 14px;">Ù…Ù‚Ø¯Ù…Ù‡: ...<br>Ø¨Ø¯Ù†Ù‡: ...<br>Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ: ...</p></div>`,
        plan: `<div style="font-family: B Titr; text-align: right;"><h4 style="color: #F57C00;">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</h4><p style="font-size: 14px;">- Û¸:Û°Û° ØµØ¨Ø­: ...<br>- Û±Û²:Û°Û° Ø¸Ù‡Ø±: ...<br>- Û¶:Û°Û° Ø¹ØµØ±: ...</p></div>`
      };
      if (templates[template]) {
        editor.innerHTML = templates[template];
        preview.innerHTML = templates[template];
        updateStatus();
        showAlert('Ù‚Ø§Ù„Ø¨ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.', 'success');
      }
    } catch (e) {
      console.error('Error in insertTemplate:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ù‚Ø§Ù„Ø¨.', 'danger');
    }
  }

  editor.addEventListener('input', updateStatus);
  window.addEventListener('load', () => {
    try {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        themeIcon.className = 'bi bi-sun';
      }
      editor.focus();
      updateStatus();
    } catch (e) {
      console.error('Error in load:', e);
      showAlert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ.', 'danger');
    }
  });

  try {
    const fontColorPickr = Pickr.create({
      el: '#fontColorPicker',
      theme: 'class
